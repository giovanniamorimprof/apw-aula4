<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Produto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

    <div id="content">
        <h1 class="text-center mb-4">Atualizar Produto</h1>
        <form id="productForm">
            <input type="text" id="productId" hidden>
            
            <!-- Nome -->
            <div class="mb-3">
                <label for="productName" class="form-label">Nome</label>
                <input type="text" class="form-control" id="productName" placeholder="Nome do produto" required>
            </div>

            <!-- Descrição -->
            <div class="mb-3">
                <label for="productDescription" class="form-label">Descrição</label>
                <textarea class="form-control" id="productDescription" rows="3" placeholder="Descrição do produto" required></textarea>
            </div>

            <!-- Preço -->
            <div class="mb-3">
                <label for="productPrice" class="form-label">Preço</label>
                <input type="number" class="form-control" id="productPrice" step="0.01" placeholder="Preço do produto" required>
            </div>

            <!-- Categoria -->
            <div class="mb-3">
                <label for="productCategory" class="form-label">Categoria</label>
                <select class="form-select" id="productCategory" required>
                    <option value="">Selecione uma categoria</option>
                    <option value="Beauty">Beleza</option>
                    <option value="Automotive">Automotivo</option>
                    <option value="Electronics">Eletrônicos</option>
                    <option value="Clothing">Roupas</option>
                </select>
            </div>

            <!-- Estoque -->
            <div class="mb-3">
                <label for="productStock" class="form-label">Estoque</label>
                <input type="number" class="form-control" id="productStock" min="0" placeholder="Quantidade em estoque" required>
            </div>

            <!-- Imagem -->
            <div class="mb-3">
                <label for="productImage" class="form-label">Imagem (URL)</label>
                <input type="url" class="form-control" id="productImage" placeholder="URL da imagem" required>
            </div>

            <!-- Botões -->
            <button type="submit" class="btn btn-success">Salvar Alterações</button>
            <a href="index.html" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const productId = params.get("id");
            const productName = params.get("nome");
            const productDescription = params.get("descricao");
            const productPrice = params.get("preco");
            const productCategory = params.get("categoria");
            const productStock = params.get("estoque");
            const productImage = params.get("imagem");

            if (productId) {
                document.getElementById("productId").value = productId;
                document.getElementById("productName").value = decodeURIComponent(productName);
                document.getElementById("productDescription").value = decodeURIComponent(productDescription);
                document.getElementById("productPrice").value = parseFloat(productPrice);
                document.getElementById("productCategory").value = decodeURIComponent(productCategory);
                document.getElementById("productStock").value = parseInt(productStock);
                document.getElementById("productImage").value = decodeURIComponent(productImage);
            }
        });

        document.getElementById("productForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const productId = document.getElementById("productId").value;
            const productName = document.getElementById("productName").value;
            const productDescription = document.getElementById("productDescription").value;
            const productPrice = document.getElementById("productPrice").value;
            const productCategory = document.getElementById("productCategory").value;
            const productStock = document.getElementById("productStock").value;
            const productImage = document.getElementById("productImage").value;

            const updatedProduct = {
                nome: productName,
                descricao: productDescription,
                preco: productPrice,
                categoria: productCategory,
                estoque: parseInt(productStock),
                imagem: productImage
            };

            try {
                // Atualiza o produto na API
                await fetch(`https://mockapi.io/projects/67d23e6f90e0670699bcc37c/${productId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedProduct)
                });

                alert("Produto atualizado com sucesso!");
                window.location.href = "index.html"; // Redireciona para a página principal
            } catch (error) {
                console.error('Erro ao atualizar produto:', error);
                alert("Erro ao atualizar o produto.");
            }
        });
    </script>

</body>
</html>